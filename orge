repeat task.wait() until game:IsLoaded()

local Library = loadstring(game:GetObjects("rbxassetid://7657867786")[1].Source)()
local Subs = Library.subs
local IsOpen = Subs.Wait


local placeId = game.PlaceId


    local Window = Library:CreateWindow({
        Name = "HackerLor",
        Themeable = {
            Info = "VTrungHackerLor",
            Credit = false,
            Background = "",
            Visible = true
        }
    })

	--// Main Tab \\--
	local MainTab = Window:CreateTab({Name = "Main"})
	local MainSection = MainTab:CreateSection({Name = "Farming"})
	local Settings = MainTab:CreateSection({Name = "Settings"})
	local Farm = MainTab:CreateSection({Name = "Farm", Side = "Right"})
	local AutoFarm = MainTab:CreateSection({Name = "AutoFarm", Side = "Left"})
	local Auto = MainTab:CreateSection({Name = "Auto", Side = "Left"})
	local Forge = MainTab:CreateSection({Name = "Forge", Side = "Left"})
	local AuraTab = MainTab:CreateSection({Name = "AuraSkills", Side = "Left"})


	--// Misc Tab \\--
	local MiscTab = Window:CreateTab({Name = "Misc"})
	local MiscSection = MiscTab:CreateSection({Name = "Misc"})
	local Ect = MiscTab:CreateSection({Name = "Ect", Side = "Left"})
	local Calamity = MiscTab:CreateSection({Name = "Calamity", Side = "Right"})
	local SpeedAndJump = MiscTab:CreateSection({Name = "Speed&Jump", Side = "Right"})

local function EnableAntiFall()
		local plr = game.Players.LocalPlayer
		if not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then
			return
		end

		local humanoidRootPart = plr.Character.HumanoidRootPart
		if not humanoidRootPart:FindFirstChild("BodyVelocity") then
			local antifall = Instance.new("BodyVelocity")
			antifall.Velocity = Vector3.new(0, 0, 0)
			antifall.MaxForce = Vector3.new(9e9, 9e9, 9e9)
			antifall.Name = "BodyVelocity"
			antifall.Parent = humanoidRootPart
		end
	end

	local function DisableAntiFall()
		local plr = game.Players.LocalPlayer
		if not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then
			return
		end

		local humanoidRootPart = plr.Character.HumanoidRootPart
		local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
		local antifall = humanoidRootPart:FindFirstChild("BodyVelocity")

		-- Xóa lực AntiFall nếu tồn tại
		if antifall then
			antifall:Destroy()
			task.wait(0.1) -- Chờ một chút để chắc chắn rằng BodyVelocity đã bị xóa
		end


		humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
		humanoidRootPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)

		if humanoid then
			humanoid.PlatformStand = false
			humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
			task.wait(0.1)


			humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end


local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

getgenv().AutoPickaxe = false 

local function StartAutoPickaxe()
    spawn(function()
        while getgenv().AutoPickaxe do
            local args = {"Pickaxe"}

            ReplicatedStorage
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Knit")
                :WaitForChild("Services")
                :WaitForChild("ToolService")
                :WaitForChild("RF")
                :WaitForChild("ToolActivated")
                :InvokeServer(unpack(args))

            task.wait(0.1)
        end
    end)
end


Auto:AddToggle({
    Name = "Auto Pickaxe",
    Default = false,
    Callback = function(state)
        getgenv().AutoPickaxe = state
        if state then
            StartAutoPickaxe()
        end
    end
})


UserInputService.InputBegan:Connect(function(input, typing)
    if typing then return end
    if input.KeyCode == Enum.KeyCode.G then
        getgenv().AutoPickaxe = not getgenv().AutoPickaxe

        if getgenv().AutoPickaxe then
            StartAutoPickaxe()
        end
    end
end)



local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

getgenv().AutoWeaponR = false


local function StartAutoWeaponR()
    task.spawn(function()
        while getgenv().AutoWeaponR do
            local args = {"Weapon", true}

            ReplicatedStorage
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Knit")
                :WaitForChild("Services")
                :WaitForChild("ToolService")
                :WaitForChild("RF")
                :WaitForChild("ToolActivated")
                :InvokeServer(unpack(args))

            task.wait(0.5)
        end
    end)
end


Auto:AddToggle({
    Name = "Auto WeaponR",
    Default = false,
    Callback = function(state)
        getgenv().AutoWeaponR = state
        if state then
            StartAutoWeaponR()
        end
    end
})


UserInputService.InputBegan:Connect(function(input, typing)
    if typing then return end
    if input.KeyCode == Enum.KeyCode.J then
        getgenv().AutoWeaponR = not getgenv().AutoWeaponR

        if getgenv().AutoWeaponR then
            StartAutoWeaponR()
        end
    end
end)




local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

getgenv().AutoWeapon02 = false


local function StartAutoWeapon02()
    task.spawn(function()
        while getgenv().AutoWeapon02 do
            local args = {"Weapon"}

            ReplicatedStorage
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Knit")
                :WaitForChild("Services")
                :WaitForChild("ToolService")
                :WaitForChild("RF")
                :WaitForChild("ToolActivated")
                :InvokeServer(unpack(args))

            task.wait(0.1)
        end
    end)
end


Auto:AddToggle({
    Name = "Auto Weapon",
    Default = false,
    Callback = function(state)
        getgenv().AutoWeapon02 = state
        if state then
            StartAutoWeapon02()
        end
    end
})


UserInputService.InputBegan:Connect(function(input, typing)
    if typing then return end
    if input.KeyCode == Enum.KeyCode.H then
        getgenv().AutoWeapon02 = not getgenv().AutoWeapon02
        if getgenv().AutoWeapon02 then
            StartAutoWeapon02()
        end
    end
end)

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- ===== UTILITY FUNCTIONS (SHARED) =====
local function trim(s)
    return s:match("^%s*(.-)%s*$")
end

local function extractQuantity(quantityText)
    if not quantityText then return 0 end
    local num = quantityText:match("x(%d+)")
    return tonumber(num) or 0
end

-- ===== SELL FUNCTIONS (CENTRALIZED) =====
local function sellItem(itemName, amount)
    if not itemName or not amount or amount <= 0 then
        return false
    end
    
    local args = {
        "SellConfirm",
        {
            Basket = {
                [itemName] = amount
            }
        }
    }
    
    local success = pcall(function()
        ReplicatedStorage
            :WaitForChild("Shared")
            :WaitForChild("Packages")
            :WaitForChild("Knit")
            :WaitForChild("Services")
            :WaitForChild("DialogueService")
            :WaitForChild("RF")
            :WaitForChild("RunCommand")
            :InvokeServer(unpack(args))
    end)
    
    return success
end

local function sellAllItems()
    local player = Players.LocalPlayer
    local stashBackground = player.PlayerGui:WaitForChild("Menu")
        :WaitForChild("Frame")
        :WaitForChild("Frame")
        :WaitForChild("Menus")
        :WaitForChild("Stash")
        :WaitForChild("Background")
    
    local itemsSold = 0
    
    for _, itemFrame in pairs(stashBackground:GetChildren()) do
        if itemFrame:IsA("Frame") or itemFrame:IsA("GuiObject") then
            local mainFrame = itemFrame:FindFirstChild("Main")
            if mainFrame then
                local hasFavorite = mainFrame:FindFirstChild("Favorite")
                
                if not hasFavorite then
                    local quantityLabel = mainFrame:FindFirstChild("Quantity")
                    if quantityLabel and quantityLabel:IsA("TextLabel") then
                        local quantityText = quantityLabel.Text
                        local amount = extractQuantity(quantityText)
                        
                        if amount > 0 then
                            local itemName = itemFrame.Name
                            local success = sellItem(itemName, amount)
                            if success then
                                itemsSold = itemsSold + 1
                                task.wait(0.2)
                            end
                        end
                    end
                end
            end
        end
    end
    
    return itemsSold
end

-- ===== PARSE INPUT FOR MANUAL SELL =====
local function ParseInput(str)
    if type(str) ~= "string" then return nil, nil end

    local amountStr = str:match("(%d+)%s*$")
    if not amountStr then
        return nil, nil
    end

    local amount = tonumber(amountStr)
    local itemPart = str:sub(1, #str - #amountStr)
    itemPart = trim(itemPart)

    if itemPart == "" then
        return nil, nil
    end

    return itemPart, amount
end

-- ===== UI: MANUAL SELL SECTION =====
Farm:AddTextbox({
    Name = "Item cần bán (VD: Copper1)",
    Default = "",
    TextDisappear = false,
    Callback = function(v)
        getgenv().SellInput = v
    end
})

Farm:AddButton({
    Name = "Bán Quặng",
    Callback = function()
        local text = getgenv().SellInput
        if not text or text == "" then
            return
        end

        local item, amount = ParseInput(text)
        if not item or not amount then
            return
        end

        sellItem(item, amount)
    end
})

Farm:AddButton({
    Name = "Bán Vật Phẩm",
    Default = false,
    Callback = function(state)
        if not state then return end

        local player = Players.LocalPlayer
        local playerGui = player:WaitForChild("PlayerGui")

        local toolsRoot = playerGui
            :WaitForChild("Menu")
            .Frame.Frame.Menus.Tools.Frame

        local function scanFolder(folder, basket)
            for _, child in pairs(folder:GetChildren()) do
                local equip = child:FindFirstChild("Equip")
                if equip and equip:FindFirstChild("TextLabel") then
                    local stateText = equip.TextLabel.Text
                    if stateText == "Equip" then
                        basket[child.Name] = true
                    end
                else
                    if #child:GetChildren() > 0 then
                        scanFolder(child, basket)
                    end
                end
            end
        end

        local function AutoSellAll()
            local basket = {}
            scanFolder(toolsRoot, basket)

            if next(basket) == nil then
                return
            end

            local args = {
                "SellConfirm",
                { Basket = basket }
            }

            ReplicatedStorage
                :WaitForChild("Shared")
                :WaitForChild("Packages")
                :WaitForChild("Knit")
                :WaitForChild("Services")
                :WaitForChild("DialogueService")
                :WaitForChild("RF")
                :WaitForChild("RunCommand")
                :InvokeServer(unpack(args))
        end

        AutoSellAll()
    end
})

Farm:AddButton({
    Name = "Sell All (Trừ Favorite)",
    Callback = function()
        sellAllItems()
    end
})
getgenv().AutoRock = false
getgenv().AutoMob = false
getgenv().TP_SPEED = 50
getgenv().PriorityTarget = ""

local DISTANCE_OFFSET = 3
local HEIGHT_OFFSET = 3
local STASH_FULL_THRESHOLD = 0.9

local Player = Players.LocalPlayer
local Rocks = Workspace:WaitForChild("Rocks")
local Living = Workspace:WaitForChild("Living")
local Proximity = Workspace:WaitForChild("Proximity")

local RockThread = nil
local MobThread = nil
local CurrentRockTarget = nil
local CurrentMobTarget = nil
local IsStashFull = false

-- ===== STASH CAPACITY =====
local function getStashCapacity()
    local success, result = pcall(function()
        local capacityLabel = Player.PlayerGui:WaitForChild("Menu")
            :WaitForChild("Frame")
            :WaitForChild("Frame")
            :WaitForChild("Menus")
            :WaitForChild("Stash")
            :WaitForChild("Capacity")
        
        local text = capacityLabel.Text
        local current, max = text:match("(%d+)/(%d+)")
        if current and max then
            return tonumber(current), tonumber(max)
        end
        return 0, 0
    end)
    
    if success then
        return result
    else
        return 0, 0
    end
end

-- ===== MOVEMENT =====
local function smoothMoveTo(position, speed)
    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp or not position then return end
    
    local startPos = hrp.Position
    local delta = position - startPos
    local duration = delta.Magnitude / speed
    local startTime = tick()
    
    while tick() - startTime < duration do
        if not getgenv().AutoRock and not getgenv().AutoMob then break end
        if IsStashFull then break end
        
        local t = math.min((tick() - startTime) / duration, 1)
        local nextPos = startPos + delta * t
        hrp.Velocity = Vector3.zero
        hrp.CFrame = CFrame.new(nextPos)
        RunService.Heartbeat:Wait()
    end
    
    hrp.Velocity = Vector3.zero
    hrp.CFrame = CFrame.new(position)
end

-- ===== ROCK FARMING =====
local function isValidRock(rock)
    if not rock then 
        return false 
    end
    
    if not rock:IsDescendantOf(Workspace) then 
        return false 
    end
    
    local success, children = pcall(function()
        return rock:GetChildren()
    end)
    
    if not success then
        return false
    end
    
    if #children == 0 then 
        return false 
    end
    
    for i, child in ipairs(children) do
        local health = child:GetAttribute("Health")
        local maxHealth = child:GetAttribute("MaxHealth")
        local lastHitPlayer = child:GetAttribute("LastHitPlayer")
        
        if health and maxHealth then
            if health <= 0 then
                return false
            end
            
            if health ~= maxHealth then 
                return false 
            end
            
            if lastHitPlayer and lastHitPlayer ~= Player.Name then
                return false
            end
            
            return true
        end
    end
    
    return false
end

local function getRockHealth(rock)
    if not rock or not rock:IsDescendantOf(Workspace) then return 0 end
    
    for _, child in ipairs(rock:GetChildren()) do
        local health = child:GetAttribute("Health")
        if health then return health end
    end
    
    return 0
end

local function getRockLastHitPlayer(rock)
    if not rock or not rock:IsDescendantOf(Workspace) then return nil end
    
    for _, child in ipairs(rock:GetChildren()) do
        local lastHitPlayer = child:GetAttribute("LastHitPlayer")
        if lastHitPlayer then return lastHitPlayer end
    end
    
    return nil
end

local function findRockByPath(rockName)
    if not rockName or trim(rockName) == "" then return nil end
    
    local priorityLower = trim(rockName):lower()
    
    for _, folder in pairs(Rocks:GetChildren()) do
        if folder:IsA("Folder") then
            for _, descendant in pairs(folder:GetDescendants()) do
                if descendant:IsA("Model") then
                    local descendantNameLower = descendant.Name:lower()
                    
                    if descendantNameLower == priorityLower or 
                       descendantNameLower:find("^" .. priorityLower:gsub("[%(%)%.%%%+%-%*%?%[%]%^%$]", "%%%1") .. "%d*$") then
                        return descendant
                    end
                end
            end
        end
    end
    
    return nil
end

local function getNearestRock()
    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    local nearest, dist = nil, math.huge
    local hasPriority = getgenv().PriorityTarget and trim(getgenv().PriorityTarget) ~= ""
    
    if hasPriority then
        local priorityTarget = findRockByPath(getgenv().PriorityTarget)
        if priorityTarget then
            return priorityTarget
        end
        print("Không tìm thấy rock:", getgenv().PriorityTarget)
    end
    
    for _, folder in pairs(Rocks:GetChildren()) do
        if folder:IsA("Folder") then
            for _, rock in pairs(folder:GetChildren()) do
                if isValidRock(rock) then
                    local pos = rock:GetPivot().Position
                    local d = (hrp.Position - pos).Magnitude
                    
                    if d < dist then
                        dist = d
                        nearest = rock
                    end
                end
            end
        end
    end
    
    return nearest
end

-- ===== GREEDY CEY FARMING =====
local function clickAtPosition(x, y)
    VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
    task.wait(0.1)
    VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
end

local function runGreedyCeyOnce()
    return task.spawn(function()
        pcall(function()
            local greedyCey = Proximity:FindFirstChild("Greedy Cey")
            if not greedyCey then
                return
            end
            
            local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
            if not hrp then
                return
            end
            

            local targetPos = greedyCey:GetPivot().Position
            
            -- Sử dụng TWEEN và ĐỢI HOÀN THÀNH
            local startPos = hrp.Position
            local delta = targetPos - startPos
            local duration = delta.Magnitude / getgenv().TP_SPEED
            local startTime = tick()
            
            while tick() - startTime < duration do
                local t = math.min((tick() - startTime) / duration, 1)
                local nextPos = startPos + delta * t
                hrp.Velocity = Vector3.zero
                hrp.CFrame = CFrame.new(nextPos)
                RunService.Heartbeat:Wait()
            end
            
            hrp.Velocity = Vector3.zero
            hrp.CFrame = CFrame.new(targetPos)

            task.wait(0.5)
            
            local proximityPrompt = greedyCey:FindFirstChild("ProximityPrompt")
            if proximityPrompt then
                fireproximityprompt(proximityPrompt)
            end
            
            task.wait(1)

            for i = 1, 4 do
                clickAtPosition(1150, 600)
                task.wait(0.2)
            end

        end)
    end)
end


local function startRockFarming()
    if RockThread then return end
    
    RockThread = task.spawn(function()
        while getgenv().AutoRock do
            pcall(function()
                -- Kiểm tra Capacity trước khi tìm mục tiêu mới
                local current, max = getStashCapacity()
                if max > 0 and current / max >= STASH_FULL_THRESHOLD then

                    IsStashFull = true
                    
                    -- Tạm dừng farm
                    CurrentRockTarget = nil
                    task.wait(0.5)
                    

                    local greedyThread = runGreedyCeyOnce()
                    
                    -- Đợi Greedy Cey hoàn thành
                    while coroutine.status(greedyThread) ~= "dead" do
                        task.wait(0.5)
                    end
                    
                    task.wait(2)

                    local beforeCurrent, beforeMax = getStashCapacity()
                    local itemsSold = sellAllItems()
                    task.wait(1)
                    
                    local afterCurrent, afterMax = getStashCapacity()

                    -- Kiểm tra nếu vẫn đầy thì tắt auto
                    if afterMax > 0 and afterCurrent / afterMax >= STASH_FULL_THRESHOLD then

                        getgenv().AutoRock = false
                        IsStashFull = false
                        RockThread = nil
                        CurrentRockTarget = nil
                        return
                    end
                    
                    -- Reset trạng thái
                    IsStashFull = false

                    task.wait(0.5)
                end
                
                -- Tìm mục tiêu mới chỉ khi chưa có target
                if not CurrentRockTarget then
                    if getgenv().PriorityTarget and trim(getgenv().PriorityTarget) ~= "" then
                        -- Tìm priority target - KIỂM TRA TÊN CHILDREN BÊN TRONG
                        local priorityLower = trim(getgenv().PriorityTarget):lower()

                        
                        for _, folder in pairs(Rocks:GetChildren()) do
                            if folder:IsA("Folder") then
                                for _, rock in pairs(folder:GetChildren()) do
                                    -- Kiểm tra children bên trong rock
                                    for _, child in pairs(rock:GetChildren()) do
                                        local childNameLower = child.Name:lower()
                                        
                                        -- So sánh tên child với priority
                                        if childNameLower == priorityLower or 
                                           childNameLower:find("^" .. priorityLower:gsub("[%(%)%.%%%+%-%*%?%[%]%^%$]", "%%%1")) then
                                            -- Tìm thấy child khớp tên, kiểm tra rock valid
                                            if isValidRock(rock) then
                                                CurrentRockTarget = rock

                                                break
                                            end
                                        end
                                    end
                                    if CurrentRockTarget then break end
                                end
                                if CurrentRockTarget then break end
                            end
                        end
                        
                        if not CurrentRockTarget then

                        end
                    else

                        local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            local nearest, dist = nil, math.huge
                            for _, folder in pairs(Rocks:GetChildren()) do
                                if folder:IsA("Folder") then
                                    for _, rock in pairs(folder:GetChildren()) do
                                        if isValidRock(rock) then
                                            local pos = rock:GetPivot().Position
                                            local d = (hrp.Position - pos).Magnitude
                                            
                                            if d < dist then
                                                dist = d
                                                nearest = rock
                                            end
                                        end
                                    end
                                end
                            end
                            CurrentRockTarget = nearest
                            if CurrentRockTarget then

                            end
                        end
                    end
                end
                
                -- Farm target hiện tại
                if CurrentRockTarget then
                    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        while getgenv().AutoRock and CurrentRockTarget and not IsStashFull do

                            local health = getRockHealth(CurrentRockTarget)
                            if health <= 0 then
                                CurrentRockTarget = nil
                                break
                            end
                            
                            -- Với normal target: kiểm tra LastHitPlayer
                            if not getgenv().PriorityTarget or trim(getgenv().PriorityTarget) == "" then
                                local lastHit = getRockLastHitPlayer(CurrentRockTarget)
                                if lastHit and lastHit ~= Player.Name then
                                    CurrentRockTarget = nil
                                    break
                                end
                            end
                            
                            if not CurrentRockTarget:IsDescendantOf(Workspace) then
                                CurrentRockTarget = nil
                                break
                            end
                            
                            hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                            if not hrp then
                                CurrentRockTarget = nil
                                break
                            end
                            
                            local targetPos = CurrentRockTarget:GetPivot().Position
                            local lookVector = hrp.CFrame.LookVector
                            local desiredPos = targetPos - (lookVector * DISTANCE_OFFSET)
                            desiredPos = desiredPos + Vector3.new(0, HEIGHT_OFFSET, 0)
                            
                            smoothMoveTo(desiredPos, getgenv().TP_SPEED)
                            
                            task.wait(0.1)
                        end
                    else
                        CurrentRockTarget = nil
                    end
                else
                    task.wait(0.5)
                end
            end)
            task.wait(0.1)
        end
        RockThread = nil
        CurrentRockTarget = nil
        IsStashFull = false
    end)
end

local function stopRockFarming()
    getgenv().AutoRock = false
    if RockThread then
        task.cancel(RockThread)
        RockThread = nil
    end
    CurrentRockTarget = nil
    IsStashFull = false
end

-- ===== MOB FARMING =====
local MobNames = {}

local function loadMobNames()
    local assets = ReplicatedStorage:FindFirstChild("Assets")
    if not assets then return end
    
    local mobsFolder = assets:FindFirstChild("Mobs")
    if not mobsFolder then return end
    
    for _, mob in pairs(mobsFolder:GetChildren()) do
        MobNames[mob.Name] = true
    end
end

loadMobNames()

local function isValidMob(mob)
    if not mob or not mob:IsDescendantOf(Workspace) then return false end
    
    local baseName = mob.Name:match("^(.-)%d*$")
    
    if not MobNames[baseName] and not MobNames[mob.Name] then
        return false
    end
    
    local humanoid = mob:FindFirstChild("Humanoid")
    if not humanoid then return false end
    
    return humanoid.Health > 0
end

local function getMobHealth(mob)
    if not mob or not mob:IsDescendantOf(Workspace) then return 0 end
    
    local humanoid = mob:FindFirstChild("Humanoid")
    if humanoid then
        return humanoid.Health
    end
    
    return 0
end

local function getNearestMob()
    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    local nearest, dist = nil, math.huge
    local hasPriority = getgenv().PriorityTarget and trim(getgenv().PriorityTarget) ~= ""
    
    if hasPriority then
        local priorityLower = trim(getgenv().PriorityTarget):lower()
        
        local isMobName = false
        for mobName, _ in pairs(MobNames) do
            local mobNameLower = mobName:lower()
            if mobNameLower == priorityLower or 
               mobNameLower:find("^" .. priorityLower:gsub("[%(%)%.%%%+%-%*%?%[%]%^%$]", "%%%1") .. "%d*$") then
                isMobName = true
                break
            end
        end
        
        if not isMobName then
            return nil
        end
        
        local priorityTarget = nil
        local priorityDist = math.huge
        
        for _, mob in pairs(Living:GetChildren()) do
            if isValidMob(mob) then
                local mobHrp = mob:FindFirstChild("HumanoidRootPart")
                if mobHrp then
                    local mobName = mob.Name
                    local mobNameLower = mobName:lower()
                    
                    if mobNameLower == priorityLower or mobNameLower:find("^" .. priorityLower:gsub("[%(%)%.%%%+%-%*%?%[%]%^%$]", "%%%1") .. "%d*$") then
                        local pos = mobHrp.Position
                        local d = (hrp.Position - pos).Magnitude
                        
                        if d < priorityDist then
                            priorityDist = d
                            priorityTarget = mob
                        end
                    end
                end
            end
        end
        
        if priorityTarget then
            return priorityTarget
        end
    end
    
    for _, mob in pairs(Living:GetChildren()) do
        if isValidMob(mob) then
            local mobHrp = mob:FindFirstChild("HumanoidRootPart")
            if mobHrp then
                local pos = mobHrp.Position
                local d = (hrp.Position - pos).Magnitude
                
                if d < dist then
                    dist = d
                    nearest = mob
                end
            end
        end
    end
    
    return nearest
end

local function startMobFarming()
    if MobThread then return end
    
    MobThread = task.spawn(function()
        while getgenv().AutoMob do
            pcall(function()
                CurrentMobTarget = getNearestMob()
                
                if CurrentMobTarget then
                    local mobHrp = CurrentMobTarget:FindFirstChild("HumanoidRootPart")
                    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                    
                    if mobHrp and hrp then
                        while getgenv().AutoMob and CurrentMobTarget do
                            local health = getMobHealth(CurrentMobTarget)
                            if health <= 0 then
                                CurrentMobTarget = nil
                                break
                            end
                            
                            if not CurrentMobTarget:IsDescendantOf(Workspace) then
                                CurrentMobTarget = nil
                                break
                            end
                            
                            mobHrp = CurrentMobTarget:FindFirstChild("HumanoidRootPart")
                            hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                            if not mobHrp or not hrp then
                                CurrentMobTarget = nil
                                break
                            end
                            
                            local targetPos = mobHrp.Position
                            local lookVector = hrp.CFrame.LookVector
                            local desiredPos = targetPos - (lookVector * DISTANCE_OFFSET)
                            
                            smoothMoveTo(desiredPos, getgenv().TP_SPEED)
                            
                            task.wait(0.1)
                        end
                    else
                        CurrentMobTarget = nil
                    end
                else
                    task.wait(0.5)
                end
            end)
            task.wait(0.1)
        end
        MobThread = nil
        CurrentMobTarget = nil
    end)
end

local function stopMobFarming()
    getgenv().AutoMob = false
    if MobThread then
        task.cancel(MobThread)
        MobThread = nil
    end
    CurrentMobTarget = nil
end

-- ===== UI: AUTO FARM TOGGLES =====
AutoFarm:AddTextbox({
    Name = "Ưu tiên Target (VD: Pebble, Zombie)",
    Default = "",
    TextDisappear = false,
    Callback = function(v)
        getgenv().PriorityTarget = v
    end
})

AutoFarm:AddToggle({
    Name = "Auto Farm Rocks",
    Flag = "AutoRockToggle",
    Keybind = false,
    Callback = function(enabled)
        getgenv().AutoRock = enabled
        if enabled then
            startRockFarming()
        else
            stopRockFarming()
        end
    end
})

AutoFarm:AddToggle({
    Name = "Auto Farm Mobs",
    Flag = "AutoMobToggle",
    Keybind = false,
    Callback = function(enabled)
        getgenv().AutoMob = enabled
        if enabled then
            startMobFarming()
        else
            stopMobFarming()
        end
    end
})

AutoFarm:AddButton({
    Name = "Chạy Greedy Cey",
    Callback = function()
        runGreedyCeyOnce()
    end
})



Forge:AddToggle({
    Name = "Auto Pour Minigame",
    Default = false,
    Callback = function(enabled)
        if enabled then
            task.spawn(function()
                local Players = game:GetService("Players")
                local player = Players.LocalPlayer
                local VirtualInputManager = game:GetService("VirtualInputManager")

                local function GetPourMinigame()
                    local playerGui = player:WaitForChild("PlayerGui")
                    local forge = playerGui:FindFirstChild("Forge")
                    if forge then
                        return forge:FindFirstChild("PourMinigame")
                    end
                    return nil
                end

                local function IsLineInArea(line, area)
                    local lineY = line.Position.Y.Scale
                    local areaY = area.Position.Y.Scale
                    local areaHeight = area.Size.Y.Scale
                    local areaMidY = areaY + (areaHeight / 2)
                    return lineY >= areaY and lineY <= (areaY + areaHeight), areaMidY
                end

                local function AutoPlayMinigame()
                    local pourMinigame = GetPourMinigame()
                    if not pourMinigame then return end

                    local frame = pourMinigame:WaitForChild("Frame")
                    local line = frame:WaitForChild("Line")
                    local area = frame:WaitForChild("Area")
                    local timer = pourMinigame:WaitForChild("Timer")
                    local bar = timer:WaitForChild("Bar")

                    local isHolding = false
                    local running = true
                    local minHoldTimeInside = 0.2
                    local lastEnterTime = 0
                    local wasInArea = false

                    local function SimulateInput(isPressed)
                        if isPressed and not isHolding then
                            isHolding = true
                            pcall(function()
                                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                            end)
                        elseif not isPressed and isHolding then
                            isHolding = false
                            pcall(function()
                                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
                            end)
                        end
                    end

                    task.spawn(function()
                        while running and pourMinigame.Visible do
                            local inArea = IsLineInArea(line, area)

                            if inArea then
                                if not wasInArea then
                                    lastEnterTime = tick()
                                end

                                if tick() - lastEnterTime >= minHoldTimeInside then
                                    SimulateInput(false)
                                end

                                wasInArea = true
                            else
                                SimulateInput(true)
                                wasInArea = false
                            end

                            if bar.Size.X.Scale >= 1 then
                                SimulateInput(false)
                                break
                            end

                            task.wait(0.03)
                        end

                        if isHolding then SimulateInput(false) end
                        running = false
                    end)

                    local connection
                    connection = pourMinigame:GetPropertyChangedSignal("Visible"):Connect(function()
                        if not pourMinigame.Visible then
                            running = false
                            if isHolding then SimulateInput(false) end
                            if connection then connection:Disconnect() end
                        end
                    end)
                end

                while enabled do
                    local pourMinigame = GetPourMinigame()
                    if pourMinigame and pourMinigame.Visible then
                        task.wait(0.5)
                        AutoPlayMinigame()
                        while pourMinigame.Visible and enabled do
                            task.wait(0.5)
                        end
                    end
                    task.wait(1)
                end
            end)
        end
    end
})



local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

getgenv().ESPenabled = false
local ESPTextSize = 18

local function createBillboard(adornee, text, parent)
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP"
    billboard.Adornee = adornee
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 0, 0)
    label.TextStrokeTransparency = 0
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = ESPTextSize
    label.TextScaled = false
    label.Text = text
    label.Parent = billboard

    return billboard, label
end

local function createESP(player)
    if player == LocalPlayer then return end

    local function attach()
        if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
            return
        end


        if player.Character:FindFirstChild("ESP") then
            player.Character.ESP:Destroy()
        end

        local root = player.Character.HumanoidRootPart
        local billboard, label = createBillboard(root, player.Name, player.Character)

        task.spawn(function()
            while getgenv().ESPenabled 
                and player.Character 
                and player.Character:FindFirstChild("HumanoidRootPart") 
                and billboard.Parent do

                local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local distance = math.floor((root.Position - hrp.Position).Magnitude)
                    label.Text = player.Name .. " | " .. distance .. " studs"
                end

                task.wait(1)
            end

            if billboard then billboard:Destroy() end
        end)
    end


    attach()


    player.CharacterAdded:Connect(function()
        task.wait(0.5)
        if getgenv().ESPenabled then
            attach()
        end
    end)
end

local function updateAllPlayers()
    for _, plr in ipairs(Players:GetPlayers()) do
        createESP(plr)
    end
end


Players.PlayerAdded:Connect(function(plr)
    if getgenv().ESPenabled then
        createESP(plr)
    end
end)

Ect:AddToggle({
    Name = "ESP",
    Flag = "ESP_Toggle",
    Callback = function(state)
        getgenv().ESPenabled = state

        if state then
            updateAllPlayers()
        else

            for _, plr in ipairs(Players:GetPlayers()) do
                if plr.Character and plr.Character:FindFirstChild("ESP") then
                    plr.Character.ESP:Destroy()
                end
            end
        end
    end
})


local Noclip = nil
local Clip = nil

function noclip()
    Clip = false
    local function Nocl()
        if Clip == false and game.Players.LocalPlayer.Character ~= nil then
            for _,v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                if v:IsA('BasePart') and v.CanCollide and v.Name ~= floatName then
                    v.CanCollide = false
                end
            end
        end
        wait(0.21) 
    end
    Noclip = game:GetService('RunService').Stepped:Connect(Nocl)
end

function clip()
    if Noclip then Noclip:Disconnect() end
    Clip = true
end

Ect:AddToggle({
    Name = "Noclip",
    Default = false,
    Callback = function(value)
        if value then
            noclip()
        else
            clip()
        end
    end
})

	--// NoClip \\--
	local antifallActive = false 
	spawn(function()
		game:GetService("RunService").Stepped:Connect(function()
			if getgenv().AutoRock or getgenv().AutoMob then
				for _, v in pairs(game:GetService("Players").LocalPlayer.Character:GetDescendants()) do
					if v:IsA("BasePart") then
						v.CanCollide = false    
					end
					if v:IsA("Humanoid") then
						v:ChangeState(11)
					end
				end
				if not antifallActive then
					antifallActive = true
					EnableAntiFall()
				end
			else
				if antifallActive then
					antifallActive = false
					DisableAntiFall()
				end
			end
		end)
	end)




Ect:AddButton({
    Name = "Fly",
    Default = false,
    Callback = function(state)
        getgenv().Fly = state
        if state then
			local main = Instance.new("ScreenGui")
			local Frame = Instance.new("Frame")
			local up = Instance.new("TextButton")
			local down = Instance.new("TextButton")
			local onof = Instance.new("TextButton")
			local TextLabel = Instance.new("TextLabel")
			local plus = Instance.new("TextButton")
			local speed = Instance.new("TextLabel")
			local mine = Instance.new("TextButton")
			local closebutton = Instance.new("TextButton")
			local mini = Instance.new("TextButton")
			local mini2 = Instance.new("TextButton")

			main.Name = "main"
			main.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
			main.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
			main.ResetOnSpawn = false

			Frame.Parent = main
			Frame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
			Frame.BorderColor3 = Color3.fromRGB(103, 221, 213)
			Frame.Position = UDim2.new(0.100320168, 0, 0.379746825, 0)
			Frame.Size = UDim2.new(0, 190, 0, 57)

			up.Name = "up"
			up.Parent = Frame
			up.BackgroundColor3 = Color3.fromRGB(79, 255, 152)
			up.Size = UDim2.new(0, 44, 0, 28)
			up.Font = Enum.Font.SourceSans
			up.Text = "UP"
			up.TextColor3 = Color3.fromRGB(0, 0, 0)
			up.TextSize = 14.000

			down.Name = "down"
			down.Parent = Frame
			down.BackgroundColor3 = Color3.fromRGB(215, 255, 121)
			down.Position = UDim2.new(0, 0, 0.491228074, 0)
			down.Size = UDim2.new(0, 44, 0, 28)
			down.Font = Enum.Font.SourceSans
			down.Text = "DOWN"
			down.TextColor3 = Color3.fromRGB(0, 0, 0)
			down.TextSize = 14.000

			onof.Name = "onof"
			onof.Parent = Frame
			onof.BackgroundColor3 = Color3.fromRGB(255, 249, 74)
			onof.Position = UDim2.new(0.702823281, 0, 0.491228074, 0)
			onof.Size = UDim2.new(0, 56, 0, 28)
			onof.Font = Enum.Font.SourceSans
			onof.Text = "fly"
			onof.TextColor3 = Color3.fromRGB(0, 0, 0)
			onof.TextSize = 14.000

			TextLabel.Parent = Frame
			TextLabel.BackgroundColor3 = Color3.fromRGB(242, 60, 255)
			TextLabel.Position = UDim2.new(0.469327301, 0, 0, 0)
			TextLabel.Size = UDim2.new(0, 100, 0, 28)
			TextLabel.Font = Enum.Font.SourceSans
			TextLabel.Text = "FLY GUI V3"
			TextLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
			TextLabel.TextScaled = true
			TextLabel.TextSize = 14.000
			TextLabel.TextWrapped = true

			plus.Name = "plus"
			plus.Parent = Frame
			plus.BackgroundColor3 = Color3.fromRGB(133, 145, 255)
			plus.Position = UDim2.new(0.231578946, 0, 0, 0)
			plus.Size = UDim2.new(0, 45, 0, 28)
			plus.Font = Enum.Font.SourceSans
			plus.Text = "+"
			plus.TextColor3 = Color3.fromRGB(0, 0, 0)
			plus.TextScaled = true
			plus.TextSize = 14.000
			plus.TextWrapped = true

			speed.Name = "speed"
			speed.Parent = Frame
			speed.BackgroundColor3 = Color3.fromRGB(255, 85, 0)
			speed.Position = UDim2.new(0.468421042, 0, 0.491228074, 0)
			speed.Size = UDim2.new(0, 44, 0, 28)
			speed.Font = Enum.Font.SourceSans
			speed.Text = "1"
			speed.TextColor3 = Color3.fromRGB(0, 0, 0)
			speed.TextScaled = true
			speed.TextSize = 14.000
			speed.TextWrapped = true

			mine.Name = "mine"
			mine.Parent = Frame
			mine.BackgroundColor3 = Color3.fromRGB(123, 255, 247)
			mine.Position = UDim2.new(0.231578946, 0, 0.491228074, 0)
			mine.Size = UDim2.new(0, 45, 0, 29)
			mine.Font = Enum.Font.SourceSans
			mine.Text = "-"
			mine.TextColor3 = Color3.fromRGB(0, 0, 0)
			mine.TextScaled = true
			mine.TextSize = 14.000
			mine.TextWrapped = true

			closebutton.Name = "Close"
			closebutton.Parent = main.Frame
			closebutton.BackgroundColor3 = Color3.fromRGB(225, 25, 0)
			closebutton.Font = "SourceSans"
			closebutton.Size = UDim2.new(0, 45, 0, 28)
			closebutton.Text = "X"
			closebutton.TextSize = 30
			closebutton.Position =  UDim2.new(0, 0, -1, 27)

			mini.Name = "minimize"
			mini.Parent = main.Frame
			mini.BackgroundColor3 = Color3.fromRGB(192, 150, 230)
			mini.Font = "SourceSans"
			mini.Size = UDim2.new(0, 45, 0, 28)
			mini.Text = "-"
			mini.TextSize = 40
			mini.Position = UDim2.new(0, 44, -1, 27)

			mini2.Name = "minimize2"
			mini2.Parent = main.Frame
			mini2.BackgroundColor3 = Color3.fromRGB(192, 150, 230)
			mini2.Font = "SourceSans"
			mini2.Size = UDim2.new(0, 45, 0, 28)
			mini2.Text = "+"
			mini2.TextSize = 40
			mini2.Position = UDim2.new(0, 44, -1, 57)
			mini2.Visible = false

			speeds = 1

			local speaker = game:GetService("Players").LocalPlayer

			local chr = game.Players.LocalPlayer.Character
			local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")

			nowe = false

			game:GetService("StarterGui"):SetCore("SendNotification", { 
				Title = "FLY GUI V3";
				Text = "BY XNEO";
				Icon = "rbxthumb://type=Asset&id=5107182114&w=150&h=150"})
			Duration = 5;

			Frame.Active = true
			Frame.Draggable = true

			onof.MouseButton1Down:connect(function()

				if nowe == true then
					nowe = false

					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Landed,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Physics,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Running,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,true)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming,true)
					speaker.Character.Humanoid:ChangeState(Enum.HumanoidStateType.RunningNoPhysics)
				else 
					nowe = true



					for i = 1, speeds do
						spawn(function()

							local hb = game:GetService("RunService").Heartbeat	


							tpwalking = true
							local chr = game.Players.LocalPlayer.Character
							local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
							while tpwalking and hb:Wait() and chr and hum and hum.Parent do
								if hum.MoveDirection.Magnitude > 0 then
									chr:TranslateBy(hum.MoveDirection)
								end
							end

						end)
					end
					game.Players.LocalPlayer.Character.Animate.Disabled = true
					local Char = game.Players.LocalPlayer.Character
					local Hum = Char:FindFirstChildOfClass("Humanoid") or Char:FindFirstChildOfClass("AnimationController")

					for i,v in next, Hum:GetPlayingAnimationTracks() do
						v:AdjustSpeed(0)
					end
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.GettingUp,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Landed,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Physics,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Running,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.RunningNoPhysics,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.StrafingNoPhysics,false)
					speaker.Character.Humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming,false)
					speaker.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
				end




				if game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Humanoid").RigType == Enum.HumanoidRigType.R6 then



					local plr = game.Players.LocalPlayer
					local torso = plr.Character.Torso
					local flying = true
					local deb = true
					local ctrl = {f = 0, b = 0, l = 0, r = 0}
					local lastctrl = {f = 0, b = 0, l = 0, r = 0}
					local maxspeed = 50
					local speed = 0


					local bg = Instance.new("BodyGyro", torso)
					bg.P = 9e4
					bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
					bg.cframe = torso.CFrame
					local bv = Instance.new("BodyVelocity", torso)
					bv.velocity = Vector3.new(0,0.1,0)
					bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
					if nowe == true then
						plr.Character.Humanoid.PlatformStand = true
					end
					while nowe == true or game:GetService("Players").LocalPlayer.Character.Humanoid.Health == 0 do
						game:GetService("RunService").RenderStepped:Wait()

						if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
							speed = speed+.5+(speed/maxspeed)
							if speed > maxspeed then
								speed = maxspeed
							end
						elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and speed ~= 0 then
							speed = speed-1
							if speed < 0 then
								speed = 0
							end
						end
						if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
							bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (ctrl.f+ctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
							lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
						elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and speed ~= 0 then
							bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
						else
							bv.velocity = Vector3.new(0,0,0)
						end

						bg.cframe = game.Workspace.CurrentCamera.CoordinateFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/maxspeed),0,0)
					end
					ctrl = {f = 0, b = 0, l = 0, r = 0}
					lastctrl = {f = 0, b = 0, l = 0, r = 0}
					speed = 0
					bg:Destroy()
					bv:Destroy()
					plr.Character.Humanoid.PlatformStand = false
					game.Players.LocalPlayer.Character.Animate.Disabled = false
					tpwalking = false




				else
					local plr = game.Players.LocalPlayer
					local UpperTorso = plr.Character.UpperTorso
					local flying = true
					local deb = true
					local ctrl = {f = 0, b = 0, l = 0, r = 0}
					local lastctrl = {f = 0, b = 0, l = 0, r = 0}
					local maxspeed = 50
					local speed = 0


					local bg = Instance.new("BodyGyro", UpperTorso)
					bg.P = 9e4
					bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
					bg.cframe = UpperTorso.CFrame
					local bv = Instance.new("BodyVelocity", UpperTorso)
					bv.velocity = Vector3.new(0,0.1,0)
					bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
					if nowe == true then
						plr.Character.Humanoid.PlatformStand = true
					end
					while nowe == true or game:GetService("Players").LocalPlayer.Character.Humanoid.Health == 0 do
						wait()

						if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
							speed = speed+.5+(speed/maxspeed)
							if speed > maxspeed then
								speed = maxspeed
							end
						elseif not (ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0) and speed ~= 0 then
							speed = speed-1
							if speed < 0 then
								speed = 0
							end
						end
						if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
							bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (ctrl.f+ctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r,(ctrl.f+ctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
							lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
						elseif (ctrl.l + ctrl.r) == 0 and (ctrl.f + ctrl.b) == 0 and speed ~= 0 then
							bv.velocity = ((game.Workspace.CurrentCamera.CoordinateFrame.lookVector * (lastctrl.f+lastctrl.b)) + ((game.Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lastctrl.l+lastctrl.r,(lastctrl.f+lastctrl.b)*.2,0).p) - game.Workspace.CurrentCamera.CoordinateFrame.p))*speed
						else
							bv.velocity = Vector3.new(0,0,0)
						end

						bg.cframe = game.Workspace.CurrentCamera.CoordinateFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/maxspeed),0,0)
					end
					ctrl = {f = 0, b = 0, l = 0, r = 0}
					lastctrl = {f = 0, b = 0, l = 0, r = 0}
					speed = 0
					bg:Destroy()
					bv:Destroy()
					plr.Character.Humanoid.PlatformStand = false
					game.Players.LocalPlayer.Character.Animate.Disabled = false
					tpwalking = false



				end

			end)

			local tis

			up.MouseButton1Down:connect(function()
				tis = up.MouseEnter:connect(function()
					while tis do
						wait()
						game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,1,0)
					end
				end)
			end)

			up.MouseLeave:connect(function()
				if tis then
					tis:Disconnect()
					tis = nil
				end
			end)

			local dis

			down.MouseButton1Down:connect(function()
				dis = down.MouseEnter:connect(function()
					while dis do
						wait()
						game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,-1,0)
					end
				end)
			end)

			down.MouseLeave:connect(function()
				if dis then
					dis:Disconnect()
					dis = nil
				end
			end)


			game:GetService("Players").LocalPlayer.CharacterAdded:Connect(function(char)
				wait(0.7)
				game.Players.LocalPlayer.Character.Humanoid.PlatformStand = false
				game.Players.LocalPlayer.Character.Animate.Disabled = false

			end)


			plus.MouseButton1Down:connect(function()
				speeds = speeds + 1
				speed.Text = speeds
				if nowe == true then


					tpwalking = false
					for i = 1, speeds do
						spawn(function()

							local hb = game:GetService("RunService").Heartbeat	


							tpwalking = true
							local chr = game.Players.LocalPlayer.Character
							local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
							while tpwalking and hb:Wait() and chr and hum and hum.Parent do
								if hum.MoveDirection.Magnitude > 0 then
									chr:TranslateBy(hum.MoveDirection)
								end
							end

						end)
					end
				end
			end)
			mine.MouseButton1Down:connect(function()
				if speeds == 1 then
					speed.Text = 'cannot be less than 1'
					wait(1)
					speed.Text = speeds
				else
					speeds = speeds - 1
					speed.Text = speeds
					if nowe == true then
						tpwalking = false
						for i = 1, speeds do
							spawn(function()

								local hb = game:GetService("RunService").Heartbeat	


								tpwalking = true
								local chr = game.Players.LocalPlayer.Character
								local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
								while tpwalking and hb:Wait() and chr and hum and hum.Parent do
									if hum.MoveDirection.Magnitude > 0 then
										chr:TranslateBy(hum.MoveDirection)
									end
								end

							end)
						end
					end
				end
			end)

			closebutton.MouseButton1Click:Connect(function()
				main:Destroy()
			end)

			mini.MouseButton1Click:Connect(function()
				up.Visible = false
				down.Visible = false
				onof.Visible = false
				plus.Visible = false
				speed.Visible = false
				mine.Visible = false
				mini.Visible = false
				mini2.Visible = true
				main.Frame.BackgroundTransparency = 1
				closebutton.Position =  UDim2.new(0, 0, -1, 57)
			end)

			mini2.MouseButton1Click:Connect(function()
				up.Visible = true
				down.Visible = true
				onof.Visible = true
				plus.Visible = true
				speed.Visible = true
				mine.Visible = true
				mini.Visible = true
				mini2.Visible = false
				main.Frame.BackgroundTransparency = 0 
				closebutton.Position =  UDim2.new(0, 0, -1, 27)
			end)
        end
    end
})



MiscSection:AddButton({
	Name = "No Fog",
	Flag = "NF",
	Keybind = false,
	Callback = function()
		local Lighting = game:GetService("Lighting")
			for _, light in ipairs(Lighting:GetChildren()) do
				if light:IsA("Atmosphere") or string.find(light.Name, "Blur") or string.find(light.Name, "Bloom") then
					light:Destroy()
				end
			Lighting.FogEnd = 1000000
		end
	end
})


local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local PLACE_ID = game.PlaceId

MiscSection:AddButton({
    Name = "Hop Server",
    Callback = function()
        TeleportService:Teleport(PLACE_ID, Players.LocalPlayer)
    end
})


local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local plr = Players.LocalPlayer
local Character = plr.Character or plr.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")


local WalkSpeed = 50
local JumpPower = 60


local function updateHumanoid(char)
    Character = char
    Humanoid = char:WaitForChild("Humanoid")


    Humanoid.WalkSpeed = WalkSpeed
    Humanoid.JumpPower = JumpPower


    Humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
        if Humanoid.WalkSpeed ~= WalkSpeed then
            Humanoid.WalkSpeed = WalkSpeed
        end
    end)

    Humanoid:GetPropertyChangedSignal("JumpPower"):Connect(function()
        if Humanoid.JumpPower ~= JumpPower then
            Humanoid.JumpPower = JumpPower
        end
    end)
end


plr.CharacterAdded:Connect(updateHumanoid)
updateHumanoid(Character)

SpeedAndJump:AddSlider({
    Name = "WalkSpeed",
    Value = WalkSpeed,
    Min = 16,
    Max = 300,
    Flag = "WalkSpeed",
    Textbox = true,
    Callback = function(state)
        WalkSpeed = state
        if Humanoid then
            Humanoid.WalkSpeed = WalkSpeed
        end
    end
})

SpeedAndJump:AddSlider({
    Name = "JumpPower",
    Value = JumpPower,
    Min = 10,
    Max = 500,
    Flag = "JumpPower",
    Textbox = true,
    Callback = function(state)
        JumpPower = state
        if Humanoid then
            Humanoid.JumpPower = JumpPower
        end
    end
})


local VirtualUser = game:GetService("VirtualUser")
	local Players = game:GetService("Players")



	local function naturalWaitTime()
		local baseTime = 600
		local offset = math.random(-120, 180)
		return math.max(300, baseTime + offset)
	end

	spawn(function()
		while true do
			wait(naturalWaitTime()) 
			if Players.LocalPlayer and Players.LocalPlayer.Character then
				VirtualUser:CaptureController()
				VirtualUser:ClickButton2(Vector2.new(math.random(100, 1820), math.random(100, 980))) 
			end
		end
	end)
